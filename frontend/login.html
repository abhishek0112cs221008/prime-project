<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - Prime Project</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <nav class="nav">
        <a href="index.html" class="nav-brand-logo">
            <div class="mi-logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M7 12h5a5 5 0 1 0 0-10H7v10Z" />
                    <path d="M7 22v-10" />
                </svg>
            </div>
            <span class="logo-name">Prime Project</span>
        </a>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">◐</button>
    </nav>

    <div class="container auth-page-container">
        <div class="auth-welcome-section">
            <h1>Welcome Back.</h1>
            <p>Sign in to access your projects and checkout.</p>
        </div>
        <div class="auth-form-container">
            <div class="form-box">
                <h2>Sign In</h2>
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="password" id="password" placeholder="Password" required>
                <div style="text-align: right; margin: -10px 0 15px;">
                    <a href="forgot-password.html" style="font-size: 13px; color: var(--text-secondary);">Forgot
                        Password?</a>
                </div>
                <p id="error-msg" class="error-msg">Invalid credentials. Please try again.</p>
                <button onclick="login()">Sign In</button>

                <div
                    style="margin: 20px 0; display: flex; align-items: center; gap: 10px; color: var(--text-secondary); font-size: 13px;">
                    <hr style="flex:1; border:0; border-top:1px solid var(--border-color);">
                    OR
                    <hr style="flex:1; border:0; border-top:1px solid var(--border-color);">
                </div>

                <div id="google-btn" style="display: flex; justify-content: center;"></div>

                <p style="margin-top: 20px;">Don't have an account? <a href="register.html">Create one</a></p>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>Copyright © 2026 Prime Project Inc. All rights reserved.</p>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Use</a>
                <a href="#">Sales and Refunds</a>
                <a href="#">Legal</a>
                <a href="#">Site Map</a>
            </div>
        </div>
    </footer>

    <script src="js/api.js"></script>
    <script>
        // Override login for token handling
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('error-msg');

            errorMsg.style.display = 'none';

            try {
                // Return structure is { user: {...}, token: "..." }
                const response = await Api.post('/auth/login', { email, password });

                if (response && response.token) {
                    // Flatten structure for easier storage: { ...userFields, token: "..." }
                    const userWithToken = { ...response.user, token: response.token };
                    localStorage.setItem('user', JSON.stringify(userWithToken));
                    window.location.href = 'index.html';
                } else {
                    throw new Error("Invalid response from server");
                }
            } catch (e) {
                console.error(e);
                errorMsg.style.display = 'block';
                errorMsg.innerText = e.message || 'Login failed. Please check your credentials.';
            }
        }
        // Google Login Handler
        async function handleCredentialResponse(response) {
            const errorMsg = document.getElementById('error-msg');
            errorMsg.style.display = 'none';

            try {
                const res = await Api.post('/auth/google', { idToken: response.credential });
                if (res && res.token) {
                    const userWithToken = { ...res.user, token: res.token };
                    localStorage.setItem('user', JSON.stringify(userWithToken));
                    window.location.href = 'index.html';
                }
            } catch (e) {
                errorMsg.style.display = 'block';
                errorMsg.innerText = "Google Sign-In failed.";
            }
        }

        window.onload = function () {
            // Configuration for Google Identity Services
            // Replace with your real Client ID in project settings
            const clientId = "602051813410-0nrnhr0ted4mbnr43c9020fe0du7kakq.apps.googleusercontent.com";

            google.accounts.id.initialize({
                client_id: clientId,
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.getElementById("google-btn"),
                { theme: "outline", size: "large", width: 320, shape: "pill" }
            );
        }
    </script>
</body>

</html>